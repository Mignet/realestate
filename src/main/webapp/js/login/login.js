function locateSysTitle(){var b=($(window).width()-$("#SystemTitle").width())/2;var a=($(window).height()-$("#SystemTitle").height())/2-100;$("#SystemTitle").css("left",b).css("top",a).show()}$(function(){function a(){if(!/(?:^sys_|^cfgPage$)/gi.test(window.name)){window.opener=null;window.open("","_self").focus();window.close()}}var c=true;try{c=admin==1?1:showTitleOverImage}catch(f){}if(c==1){locateSysTitle()}var g=$.cookie("username");var d=$.cookie("uid");var b=esys.getURLParameter("focus");if(g!=null&&d!=null){$("#username").val(g);$("#uid").val(d);if(b!="username"){$("#password").focus()}else{$("#username").select().focus()}}else{$("#username").focus()}$("#username").keypress(function(h){if(h.keyCode==13){if(!$("#username").val()){$("#username").focus();return true}if($(".window").length>=3){for(var e=0;e<$(".l-btn").length;e++){if($(".l-btn").css("display")=="inline-block"){$(".l-btn").get(e).click()}}return true}$("#password").focus()}});$("#username").keyup(function(){if(event.keyCode!=13){$("#uid").val("")}});$("#password").keypress(function(h){if(h.keyCode==13){if($(".window").length>=3){for(var e=0;e<$(".l-btn").length;e++){if($(".l-btn").css("display")=="inline-block"){$(".l-btn").get(e).click()}}return true}$("#btnLogin").click();h.preventDefault()}});$("#btnLogin").click(function(j){var k=$.trim($("#username").val());var h=$.trim($("#password").val());var i=$("#uid").val();if(k==""){$.messager.alert("错误","请填写用户名!","error",function(){$("#username").focus()})}else{if(h==""){$.messager.alert("错误","密码不能为空!","error",function(){$("#password").focus()})}else{if(admin){$.ajax({type:"get",url:"logonadmin.htm",data:{uid:i,username:k,password:$.md5(h)},success:function(l){if(l=="1"){try{esys.openFullScreenWin("index.htm?dt="+new Date().getTime(),"cfgPage");$.cookie("username",k,{expires:30});$.cookie("uid",i,{expires:30});a()}catch(m){}}else{if(l=="-1"){$.messager.alert("消息","您没有登录权限，请联系管理员!")}else{$.messager.alert("错误","用户名或者密码不正确!","error",function(){$("#password").select()})}}},dataType:"text"})}else{$.ajax({type:"get",url:"checklogon.htm",data:{uid:i,username:k,password:$.md5(h),agent:$("#agent").val()?$("#agent").val():-1},success:function(e){var n=e.code;var l=e.data.appCode;var p=e.message;if(n==4){var o=e.data;confirm(e.message||"系统检测到用户已在其他机器登录，强制登录将使其不能继续使用，确定继续？",{onOK:function(){o.logonType=1;esys.request("ipconflict.htm?dt="+new Date().getTime(),o,function(q){if(q.code==-1){$.messager.alert("错误","强制登录失败，请联系管理员!","error")}else{n=1;m()}})},onCancel:function(){o.logonType=-1;esys.request("ipconflict.htm?dt="+new Date().getTime(),o)}})}else{m()}function m(){if(n==1){if(j&&j.ctrlKey){esys.openFullScreenWin("../admin/index.htm?dt="+new Date().getTime(),"cfgPage")}else{esys.openFullScreenWin("index.htm?dt="+new Date().getTime(),"sys_"+(l?l:"work"))}$.cookie("username",k,{expires:30});$.cookie("uid",i,{expires:30});a()}else{if(n==-1){$.messager.alert("消息",p||"您没有系统登录权限，请联系管理员!")}else{if(n==2){$.messager.alert("消息","用户名重复，请用人员代码登录！")}else{if(n==3){$.messager.alert("消息","用户已禁用，请联系管理员！")}else{$.messager.alert("错误","用户名或者密码不正确!","error",function(){$("#password").select()})}}}}}},dataType:"json"})}}}});$("#proxyLogin").click(function(){if($.trim($("#agent").val())==""){var h=$.trim($("#username").val());var e=$.trim($("#password").val());if(g==""){$.messager.alert("错误","请填写用户名!","error",function(){$("#username").focus()});return false}else{if(e==""){$.messager.alert("错误","密码不能为空!","error",function(){$("#password").focus()});return false}}$("#agentTable").empty();$.ajax({type:"get",url:"getAgents.htm",data:{userName:h},success:function(j){if(j){if(j.length>0){if(j.length==1){$("#agent").val(j[0].HUMANID);$("#btnLogin").click()}else{var i="";$.each(j,function(k){i+="<tr><td><input type='radio' id='agent_"+this.HUMANID+"' name='agent' value='"+this.HUMANID+"' /></td><td><label for='agent_"+this.HUMANID+"'>"+this.HUMANNAME+"</label></td></tr>"});$("#agentTable").append(i);$("#agentWin").dialog("open")}}else{$.messager.alert("消息","还没有任务事项由您代理!")}}else{$.messager.alert("消息","获取代理人列表失败!")}},error:function(){$.messager.alert("消息","获取代理人列表失败!")}})}else{$("#btnLogin").click()}});$("#okBtn").click(function(){if($("#agentTable input[name='agent']").val()){$("#agent").val($("#agentTable input[name='agent']:checked").val())}$("#agentWin").dialog("close");$("#btnLogin").click()});$("#cancelBtn").click(function(){$("#agent").val("");$("#agentWin").dialog("close")});$("#username").autocomplete("usernameAutoComplete.htm",{minChars:0,max:100,matchContains:true,scroll:true,scrollHeight:200,mustMatch:false,selectFirst:true,highlight:false,parse:function(e){return $.map(e,function(j,h){return{data:j,value:j.HUMANNAME+(j.HUMANCODE?"("+j.HUMANCODE+")":""),result:j.HUMANNAME}})},formatItem:function(e){return e.HUMANNAME+(e.HUMANCODE?"("+e.HUMANCODE+")":"")},formatMatch:function(e){return e.HUMANNAME+(e.HUMANCODE?"("+e.HUMANCODE+")":"")},formatResult:function(e){return e.HUMANNAME+(e.HUMANCODE?"("+e.HUMANCODE+")":"")}}).result(function(e,i,h){$("#uid").val(i.HUMANID)});$(window).resize(function(){if(c==1){locateSysTitle()}})});
